<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>Sé un Beneficiario - Unidos Corazones</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

    <link rel="stylesheet" th:href="@{/css/actividades.css}">

    <style>
        .hero-image-col {
            min-height: 100vh;
            background-position: center center;
            background-size: cover;
            background-repeat: no-repeat;
        }

        /* Ajustes Responsive */
        @media (max-width: 991px) {
            .hero-image-col {
                min-height: 300px;
                border-radius: 0 0 20px 20px;
                margin-bottom: 2rem;
                position: relative !important;
            }
        }

        .form-control, .form-select {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
        }

        /* Asegurar que el contenido baje lo suficiente */
        .main-content-wrapper {
            margin-top: 2rem;
        }

        .form-control[readonly] {
            background-color: #e9ecef;
            cursor: not-allowed;
        }

        footer {
            background-color: #537b65;
            color: white;
        }
    </style>
</head>
<body>

<header class="navbar navbar-expand-lg navbar-light bg-white fixed-top py-3 shadow-sm">
    <div class="container">
        <a class="navbar-brand d-flex align-items-center" th:href="@{/inicio.html}">
            <img th:src="@{/img/logo.png}" alt="Unidos Corazones" height="50" class="me-2">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#menu">
            <span class="navbar-toggler-icon"></span>
        </button>
        <nav class="collapse navbar-collapse justify-content-end" id="menu">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="#">Inicio</a></li>
                <li class="nav-item"><a class="nav-link" href="#">Quiénes Somos</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/public/actividades}">Actividades</a>
                </li>
            </ul>
            <a th:href="@{/public/registro-voluntario}" class="btn btn-success ms-lg-3">Registrarse</a>
        </nav>
    </div>
</header>

<div class="container-fluid p-0">
    <div class="row g-0">

        <!-- IMAGEN -->
        <div class="col-lg-5 d-none d-lg-block position-fixed h-100 start-0 top-0 hero-image-col"
             th:style="'z-index: 0; background-image: url(' + @{/img/beneficiarioForm.jpg} + ');'">
        </div>
        <div class="col-lg-5 d-none d-lg-block"></div>

        <!-- FORMULARIO -->
        <div class="col-lg-7">
            <div class="container py-5 px-lg-5 mt-4">
                <div class="row justify-content-center">
                    <div class="col-md-10 col-xl-9">

                        <div class="mb-5 mt-lg-4">
                            <h1 class="display-4 page-title">Sé un beneficiario</h1>
                            <p class="text-muted lead mt-3">
                                Si tú, tu familia o tu organización necesitan apoyo, completa este formulario.
                                Nuestro equipo evaluará tu solicitud para brindarte la ayuda necesaria.
                            </p>
                        </div>

                        <h3 class="fw-bold mb-4">Regístrate como Beneficiario</h3>

                        <form th:action="@{/public/registro-beneficiario/guardar}"
                              th:object="${beneficiario}"
                              method="POST"
                              enctype="multipart/form-data"
                              id="formRegistro">

                            <!-- Razón Social / Nombre -->
                            <div class="mb-4">
                                <label class="form-label">Razón social o Nombre Completo</label>
                                <input type="text" class="form-control" th:field="*{nombreCompletoORazon}"
                                       placeholder="Escribe aquí a la organización o tu nombre..." required>
                            </div>

                            <div class="row g-3 mb-4">
                                <!-- Tipo Beneficiario -->
                                <div class="col-md-6">
                                    <label class="form-label">Tipo de Solicitante</label>
                                    <select class="form-select" th:field="*{tipoBeneficiario}" id="tipoBeneficiario">
                                        <option value="Organizacion">Organización / Grupo</option>
                                        <option value="Familia">Familia</option>
                                        <option value="Persona">Persona Individual</option>
                                    </select>
                                </div>
                                <!-- Personas Afectadas -->
                                <div class="col-md-6">
                                    <label class="form-label">Personas beneficiadas (Aprox)</label>
                                    <input type="number" class="form-control" th:field="*{cantidadPersonasAfectadas}"
                                           id="cantidadPersonas" value="1" min="1" required>
                                </div>
                            </div>

                            <!-- Teléfono -->
                            <div class="mb-4">
                                <label class="form-label">Teléfono de contacto (9 dígitos)</label>
                                <input type="tel" class="form-control" th:field="*{celular}" id="celular"
                                       placeholder="987 654 321" required
                                       pattern="[0-9]{9}" maxlength="9"
                                       title="El teléfono debe tener exactamente 9 dígitos numéricos">
                            </div>

                            <!-- Documento -->
                            <div class="row g-3 mb-4">
                                <div class="col-md-4">
                                    <label class="form-label">Tipo de Documento</label>
                                    <select class="form-select" th:field="*{tipoDocumento}" id="tipoDocumento">
                                        <option value="DNI">DNI</option>
                                        <option value="RUC">RUC</option>
                                        <option value="CE">C.E.</option>
                                    </select>
                                </div>
                                <div class="col-md-8">
                                    <label class="form-label">Número de Documento del Representante</label>
                                    <input type="text" class="form-control" th:field="*{numeroDocumento}"
                                           id="numeroDocumento"
                                           placeholder="Ingrese el número" required>
                                    <div class="form-text" id="docHelp">Debe tener 8 dígitos para DNI.</div>
                                </div>
                            </div>

                            <!-- Correo -->
                            <div class="mb-4">
                                <label class="form-label">Dirección de correo electrónico</label>
                                <input type="email" class="form-control" th:field="*{correo}"
                                       placeholder="contacto@ejemplo.com" required
                                       pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                                       title="Ingrese un correo válido (Ejemplo: usuario@dominio.com)">
                            </div>

                            <!-- Dirección -->
                            <div class="mb-4">
                                <label class="form-label">Dirección / Domicilio</label>
                                <input type="text" class="form-control" th:field="*{direccion}"
                                       placeholder="Av. Principal 123" required>
                            </div>

                            <!-- Justificación -->
                            <div class="mb-4">
                                <label class="form-label">Justificación de Solicitud</label>
                                <textarea class="form-control" th:field="*{justificacionSolicitud}" rows="4"
                                          placeholder="Cuéntanos brevemente tu situación..." required></textarea>
                            </div>

                            <!-- Archivos -->
                            <div class="p-3 bg-light rounded-3 mb-4 border">
                                <h6 class="fw-bold mb-3"><i class="bi bi-paperclip"></i> Documentación</h6>

                                <div class="mb-3">
                                    <label for="archivoDni" class="form-label small text-secondary">Captura de DNI del
                                        Representante (Obligatorio)</label>
                                    <input type="file" class="form-control" name="archivoDni" id="archivoDni"
                                           accept="image/*,.pdf" required>
                                </div>

                                <div>
                                    <label for="archivoApoyo" class="form-label small text-secondary">Documentos de
                                        Apoyo
                                        (Opcional) | Máx. 3 archivos (PDF o Imagen)</label>
                                    <!-- Agregado 'multiple' para permitir selección múltiple -->
                                    <input type="file" class="form-control" name="archivoApoyo" id="archivoApoyo"
                                           accept="image/*,.pdf" multiple>
                                </div>
                            </div>

                            <div class="d-grid mt-5">
                                <button type="submit" class="btn btn-success btn-lg py-3 fw-bold shadow-sm">Enviar
                                    Solicitud
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<footer class="text-white mt-auto position-relative" style="z-index: 10;">
    <div class="container py-4">
        <div class="row align-items-center justify-content-between">
            <div class="col-md-6 mb-4 mb-md-0 text-center text-md-start">
                <h5 class="fw-bold">Unidos Corazones</h5>
                <p class="mb-2">Comprometidos con el bienestar de miles de necesitados</p>
                <a th:href="@{/login}" class="btn btn-light btn-sm fw-bold text-success">Administración</a>
            </div>
            <div class="col-md-4 text-md-end text-center">
                <h6 class="fw-bold">Síguenos</h6>
                <div class="social-icons mt-2">
                    <a href="#" class="text-white me-3 text-decoration-none"><i class="bi bi-facebook"></i></a>
                    <a href="#" class="text-white me-3 text-decoration-none"><i class="bi bi-linkedin"></i></a>
                    <a href="#" class="text-white me-3 text-decoration-none"><i class="bi bi-instagram"></i></a>
                    <a href="#" class="text-white text-decoration-none"><i class="bi bi-youtube"></i></a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- SCRIPT DE VALIDACIONES PERSONALIZADAS -->
<script>
    document.addEventListener('DOMContentLoaded', function () {

        // 1. VALIDACIÓN PERSONAS BENEFICIADAS
        const tipoBeneficiario = document.getElementById('tipoBeneficiario');
        const cantidadPersonas = document.getElementById('cantidadPersonas');

        function validarCantidad() {
            if (tipoBeneficiario.value === 'Persona') { // Si es Persona Individual
                cantidadPersonas.value = 1;
                cantidadPersonas.setAttribute('readonly', true);
            } else {
                cantidadPersonas.removeAttribute('readonly');
            }
        }
        // Escuchar cambios y ejecutar al inicio
        tipoBeneficiario.addEventListener('change', validarCantidad);
        validarCantidad(); // Ejecutar al cargar por si el navegador recuerda el valor


        // 2. VALIDACIÓN DOCUMENTO (DNI, RUC, CE)
        const tipoDocumento = document.getElementById('tipoDocumento');
        const numeroDocumento = document.getElementById('numeroDocumento');
        const docHelp = document.getElementById('docHelp');

        function validarDocumento() {
            const tipo = tipoDocumento.value;
            let longitud = 8; // Por defecto DNI

            if (tipo === 'RUC') longitud = 11;
            else if (tipo === 'CE') longitud = 12;

            numeroDocumento.setAttribute('maxlength', longitud);
            numeroDocumento.setAttribute('minlength', longitud);
            numeroDocumento.setAttribute('pattern', `[0-9]{${longitud}}`);

            // Limpiar si excede la longitud al cambiar de tipo
            if (numeroDocumento.value.length > longitud) {
                numeroDocumento.value = "";
            }

            docHelp.textContent = `Debe tener ${longitud} dígitos para ${tipo}.`;
        }

        // Solo permitir números en el campo documento
        numeroDocumento.addEventListener('input', function() {
            this.value = this.value.replace(/[^0-9]/g, '');
        });

        tipoDocumento.addEventListener('change', validarDocumento);
        validarDocumento();


        // 3. VALIDACIÓN CELULAR (Solo Números)
        const celular = document.getElementById('celular');
        celular.addEventListener('input', function() {
            this.value = this.value.replace(/[^0-9]/g, ''); // Elimina cualquier caracter no numérico
        });


        // 4. VALIDACIÓN ARCHIVOS (Max 3 y Peso)
        const archivoApoyo = document.getElementById('archivoApoyo');

        archivoApoyo.addEventListener('change', function() {
            // Validar cantidad
            if (this.files.length > 3) {
                alert('Solo puedes subir un máximo de 3 archivos de apoyo.');
                this.value = ''; // Limpiar selección
                return;
            }

            // Validar peso individual (Max 5MB por ejemplo)
            const maxSize = 5 * 1024 * 1024; // 5MB en bytes
            for (let i = 0; i < this.files.length; i++) {
                if (this.files[i].size > maxSize) {
                    alert(`El archivo "${this.files[i].name}" es demasiado pesado. El límite es 5MB.`);
                    this.value = ''; // Limpiar selección
                    break;
                }
            }
        });

    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>